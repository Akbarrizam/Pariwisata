{{ template "header" . }}

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
    /* Hilangkan scrollbar default agar slider bersih */
    .no-scrollbar::-webkit-scrollbar {
        display: none;
    }
    .no-scrollbar {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
    }
</style>

<div class="container mx-auto px-6 py-10">
    <div class="text-sm text-slate-500 mb-6">
        <a href="/" class="hover:text-blue-600">Home</a> <span class="mx-2">/</span> 
        <span class="text-slate-800 font-semibold">{{ .destination.Name }}</span>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
        
        <div class="lg:col-span-2">
            
            <div class="relative group rounded-2xl overflow-hidden shadow-lg mb-4 h-[450px] bg-slate-100 border border-slate-200">
                
                <div id="slider" class="flex w-full h-full overflow-x-auto snap-x snap-mandatory scroll-smooth no-scrollbar">
                    {{ if .destination.Galleries }}
                        {{ range .destination.Galleries }}
                        <div class="w-full h-full flex-shrink-0 snap-center relative">
                            <img src="/uploads/{{ .ImageURL }}" class="w-full h-full object-cover">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent opacity-60"></div>
                        </div>
                        {{ end }}
                    {{ else }}
                        <div class="w-full h-full flex flex-col items-center justify-center bg-slate-200 text-slate-400">
                            <i class="fas fa-image text-6xl mb-2"></i>
                            <span class="text-sm">Tidak ada foto tersedia</span>
                        </div>
                    {{ end }}
                </div>

                {{ if .destination.Galleries }}
                <button onclick="slideLeft()" class="absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/30 backdrop-blur-md rounded-full flex items-center justify-center text-white hover:bg-white hover:text-indigo-600 transition shadow-lg opacity-0 group-hover:opacity-100 z-10">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button onclick="slideRight()" class="absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/30 backdrop-blur-md rounded-full flex items-center justify-center text-white hover:bg-white hover:text-indigo-600 transition shadow-lg opacity-0 group-hover:opacity-100 z-10">
                    <i class="fas fa-chevron-right"></i>
                </button>
                {{ end }}
            </div>

            {{ if .destination.Galleries }}
            <div class="flex gap-3 overflow-x-auto pb-4 mb-8 custom-scrollbar">
                {{ range $index, $element := .destination.Galleries }}
                    <div class="relative w-24 h-24 flex-shrink-0 cursor-pointer group" onclick="slideToIndex({{ $index }})">
                        <img src="/uploads/{{ .ImageURL }}" class="w-full h-full rounded-xl object-cover border-2 border-transparent group-hover:border-indigo-500 transition">
                        <div class="absolute inset-0 bg-black/10 group-hover:bg-transparent rounded-xl transition"></div>
                    </div>
                {{ end }}
            </div>
            {{ end }}

            <h1 class="text-4xl font-bold text-slate-800 mb-4">{{ .destination.Name }}</h1>
            
            <p class="text-slate-600 leading-relaxed mb-8 text-lg text-justify">
                {{ .destination.Description }}
            </p>

            <div class="bg-white rounded-xl shadow-sm border border-slate-100 p-8">
                <h3 class="text-2xl font-bold text-slate-800 mb-6">Ulasan Pengunjung</h3>
                
                <div class="space-y-6 mb-8">
                    {{ range .destination.Reviews }}
                    <div class="flex items-start space-x-4 pb-6 border-b border-slate-100 last:border-0">
                        <div class="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center font-bold text-slate-500 uppercase">
                            {{ printf "%.1s" .VisitorName }}
                        </div>
                        <div>
                            <div class="flex items-center mb-1">
                                <h4 class="font-bold text-slate-800 mr-2">{{ .VisitorName }}</h4>
                                <div class="text-yellow-400 text-xs">
                                    <i class="fas fa-star"></i> {{ .Rating }}/5
                                </div>
                            </div>
                            <p class="text-slate-600 text-sm">{{ .Comment }}</p>
                        </div>
                    </div>
                    {{ else }}
                        <div class="text-center py-10 bg-slate-50 rounded-xl">
                            <p class="text-slate-400 italic">Belum ada ulasan untuk tempat ini.</p>
                        </div>
                    {{ end }}
                </div>

                <form action="/review" method="POST" class="bg-slate-50 p-6 rounded-xl border border-slate-200">
                    <h4 class="font-bold text-slate-700 mb-4">Tulis Ulasan Anda</h4>
                    <input type="hidden" name="destination_id" value="{{ .destination.ID }}">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <input type="text" name="visitor_name" placeholder="Nama Anda" class="w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-blue-500 outline-none" required>
                        <select name="rating" class="w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-blue-500 outline-none bg-white">
                            <option value="5">⭐⭐⭐⭐⭐ (Sempurna)</option>
                            <option value="4">⭐⭐⭐⭐ (Bagus)</option>
                            <option value="3">⭐⭐⭐ (Cukup)</option>
                            <option value="2">⭐⭐ (Kurang)</option>
                            <option value="1">⭐ (Buruk)</option>
                        </select>
                    </div>
                    <textarea name="comment" rows="3" placeholder="Ceritakan pengalaman anda..." class="w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-blue-500 outline-none mb-4" required></textarea>
                    <button type="submit" class="bg-slate-900 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-600 transition shadow-lg">Kirim Ulasan</button>
                </form>
            </div>
        </div>

        <div class="lg:col-span-1">
            
            <div class="bg-white rounded-2xl shadow-lg border border-slate-100 p-6 sticky top-24 z-10">
                <div class="text-slate-500 text-sm font-semibold uppercase tracking-wider mb-2">Harga Tiket</div>
                <div class="text-3xl font-bold text-blue-600 mb-6">Rp {{ .destination.Price }}</div>

                <div class="space-y-4 mb-6">
                    <div class="flex items-center text-slate-600">
                        <i class="fas fa-map-marker-alt w-8 text-center text-red-500"></i>
                        <span>{{ .destination.Location }}</span>
                    </div>
                    <div class="flex items-center text-slate-600">
                        <i class="fas fa-tag w-8 text-center text-green-500"></i>
                        <span>{{ .destination.Category.Name }}</span>
                    </div>
                </div>

                <form action="/checkout" method="POST">
                    <input type="hidden" name="destination_id" value="{{ .destination.ID }}">
                    <input type="hidden" name="price" value="{{ .destination.Price }}">
                    
                    <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-cyan-500 text-white font-bold py-3 rounded-xl shadow-lg shadow-blue-500/30 hover:shadow-blue-500/50 transition transform hover:-translate-y-1">
                        Beli Tiket Sekarang
                    </button>
                </form>
            </div>

            <div class="bg-white rounded-2xl shadow-lg border border-slate-100 p-6 mt-8 sticky top-[450px]">
                <h3 class="text-lg font-bold text-slate-800 mb-4">Lokasi Wisata</h3>
                
                <div id="mapDetail" class="w-full h-64 rounded-xl z-0 border border-slate-200"></div>
                
                <div class="mt-4 flex items-center justify-between">
                    <span class="text-sm text-slate-500 truncate max-w-[150px]">
                        <i class="fas fa-map-pin mr-2 text-red-500"></i>{{ .destination.Location }}
                    </span>
                    <a href="https://www.google.com/maps/search/?api=1&query={{ .destination.Latitude }},{{ .destination.Longitude }}" target="_blank" class="text-sm font-bold text-indigo-600 hover:underline">
                        Buka Google Maps
                    </a>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        
        // --- 1. LOGIC MAP (PETA) ---
        var lat = {{ .destination.Latitude }};
        var lng = {{ .destination.Longitude }};
        var name = "{{ .destination.Name }}";

        if (lat !== 0 && lng !== 0) {
            var map = L.map('mapDetail').setView([lat, lng], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);
            L.marker([lat, lng]).addTo(map)
                .bindPopup("<b>" + name + "</b><br>Lokasi Wisata").openPopup();
        } else {
            document.getElementById('mapDetail').innerHTML = '<div class="h-full flex items-center justify-center text-slate-400 bg-slate-50 rounded-xl border border-dashed border-slate-300">Peta tidak tersedia</div>';
        }
    });

    // --- 2. LOGIC SLIDER (CAROUSEL) ---
    const slider = document.getElementById('slider');

    function slideLeft() {
        slider.scrollBy({ left: -slider.clientWidth, behavior: 'smooth' });
    }

    function slideRight() {
        slider.scrollBy({ left: slider.clientWidth, behavior: 'smooth' });
    }

    function slideToIndex(index) {
        // Scroll ke gambar tertentu
        slider.scrollTo({
            left: slider.clientWidth * index,
            behavior: 'smooth'
        });
    }
</script>

{{ template "footer" . }}